#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
–ù–ê–°–¢–†–û–ô–ö–ò –°–ò–°–¢–ï–ú–´ - –£–ö–ê–ñ–ò–¢–ï –ó–î–ï–°–¨ –ü–£–¢–ò –ö –í–ê–®–ò–ú –§–ê–ô–õ–ê–ú
"""

import os

# ============================================================================
# –ü–£–¢–ò –ö –§–ê–ô–õ–ê–ú - –ò–ó–ú–ï–ù–ò–¢–ï –≠–¢–ò –ó–ù–ê–ß–ï–ù–ò–Ø –ü–û–î –°–í–û–ò –§–ê–ô–õ–´
# ============================================================================

# –ü—É—Ç—å –∫ –ø–∞–ø–∫–µ —Å —Ñ–∞–π–ª–∞–º–∏ (–µ—Å–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º, –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ —Ç–µ–∫—É—â–∞—è –ø–∞–ø–∫–∞)
FOLDER_PATH = ""  # –ù–∞–ø—Ä–∏–º–µ—Ä: "/home/user/documents/products" –∏–ª–∏ "C:\\Users\\User\\Documents"

# –ï—Å–ª–∏ FOLDER_PATH –ø—É—Å—Ç–æ–π, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—É—â—É—é –ø–∞–ø–∫—É
if not FOLDER_PATH:
    FOLDER_PATH = os.path.dirname(os.path.abspath(__file__))

# –§–∞–π–ª —Å —Ç–æ–≤–∞—Ä–∞–º–∏ (product)
PRODUCT_FILE = os.path.join(FOLDER_PATH, "product1.xlsx")

# –§–∞–π–ª —Å –≤–∫—É—Å–∞–º–∏ (SKU)
SKU_FILE = os.path.join(FOLDER_PATH, "sku_vkus.xlsx")

# –§–∞–π–ª —Å –Ω–æ–≤—ã–º–∏ —Ç–æ–≤–∞—Ä–∞–º–∏ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ (–≤—Ö–æ–¥–Ω–æ–π —Ñ–∞–π–ª)
INPUT_FILE = os.path.join(FOLDER_PATH, "new_products.csv")

# –í—ã—Ö–æ–¥–Ω–æ–π —Ñ–∞–π–ª –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
OUTPUT_PRODUCT_FILE = os.path.join(FOLDER_PATH, "product1_updated.xlsx")

# –í—ã—Ö–æ–¥–Ω–æ–π —Ñ–∞–π–ª –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –≤–∫—É—Å–æ–≤
OUTPUT_SKU_FILE = os.path.join(FOLDER_PATH, "sku_vkus_updated.xlsx")

# –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –æ–±—É—á–µ–Ω–∏–∏)
KNOWLEDGE_BASE_FILE = os.path.join(FOLDER_PATH, "knowledge_base.json")

# –ë–∞–∑–∞ –±—Ä–µ–Ω–¥–æ–≤ (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –æ–±—É—á–µ–Ω–∏–∏)
BRANDS_DB_FILE = os.path.join(FOLDER_PATH, "brands_db.json")

# –õ–æ–≥ —Ñ–∞–π–ª
LOG_FILE = os.path.join(FOLDER_PATH, "categorizer.log")


# ============================================================================
# –ù–ê–°–¢–†–û–ô–ö–ò –û–ë–†–ê–ë–û–¢–ö–ò
# ============================================================================

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—É—á–∞—Ç—å—Å—è –Ω–∞ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
AUTO_LEARN = True

# –ü–æ—Ä–æ–≥–∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –±—Ä–µ–Ω–¥–æ–≤ (%)
BRAND_CONFIDENCE_THRESHOLDS = {
    'exact': 100,           # –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
    'high': 90,            # –í—ã—Å–æ–∫–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å
    'medium': 75,          # –°—Ä–µ–¥–Ω—è—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å
    'low': 60              # –ù–∏–∑–∫–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å
}

# –†–∞–∑–º–µ—Ä –≤—ã–±–æ—Ä–∫–∏ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –º–æ–¥–µ–ª–∏
VALIDATION_SAMPLE_SIZE = 500

# –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π –ø—Ä–∏ –æ–±—É—á–µ–Ω–∏–∏
MIN_CONFIDENCE_TO_LEARN = 80.0

# –í—ã–≤–æ–¥–∏—Ç—å –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ
VERBOSE = True


# ============================================================================
# –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò
# ============================================================================

def check_files():
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —Ñ–∞–π–ª–æ–≤"""
    errors = []
    warnings = []
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã
    if not os.path.exists(PRODUCT_FILE):
        errors.append(f"‚ùå –§–∞–π–ª —Å —Ç–æ–≤–∞—Ä–∞–º–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω: {PRODUCT_FILE}")
    
    if not os.path.exists(SKU_FILE):
        errors.append(f"‚ùå –§–∞–π–ª —Å –≤–∫—É—Å–∞–º–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω: {SKU_FILE}")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Ö–æ–¥–Ω–æ–π —Ñ–∞–π–ª (–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –Ω–µ –æ—à–∏–±–∫–∞)
    if not os.path.exists(INPUT_FILE):
        warnings.append(f"‚ö†Ô∏è  –í—Ö–æ–¥–Ω–æ–π —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω: {INPUT_FILE}")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π (–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ)
    if not os.path.exists(KNOWLEDGE_BASE_FILE):
        warnings.append(f"‚ö†Ô∏è  –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–∞: {KNOWLEDGE_BASE_FILE} (–±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞ –ø—Ä–∏ –æ–±—É—á–µ–Ω–∏–∏)")
    
    if not os.path.exists(BRANDS_DB_FILE):
        warnings.append(f"‚ö†Ô∏è  –ë–∞–∑–∞ –±—Ä–µ–Ω–¥–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞: {BRANDS_DB_FILE} (–±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞ –ø—Ä–∏ –æ–±—É—á–µ–Ω–∏–∏)")
    
    return errors, warnings


def print_settings():
    """–í—ã–≤–æ–¥ —Ç–µ–∫—É—â–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫"""
    print("\n" + "="*80)
    print("  –¢–ï–ö–£–©–ò–ï –ù–ê–°–¢–†–û–ô–ö–ò")
    print("="*80)
    print(f"\nüìÅ –ü–∞–ø–∫–∞ —Å —Ñ–∞–π–ª–∞–º–∏: {FOLDER_PATH}")
    print(f"\nüìä –§–∞–π–ª—ã:")
    print(f"   –¢–æ–≤–∞—Ä—ã:      {os.path.basename(PRODUCT_FILE)}")
    print(f"   –í–∫—É—Å—ã:       {os.path.basename(SKU_FILE)}")
    print(f"   –í—Ö–æ–¥–Ω–æ–π:     {os.path.basename(INPUT_FILE)}")
    print(f"\nüì§ –í—ã—Ö–æ–¥–Ω—ã–µ —Ñ–∞–π–ª—ã:")
    print(f"   –¢–æ–≤–∞—Ä—ã:      {os.path.basename(OUTPUT_PRODUCT_FILE)}")
    print(f"   –í–∫—É—Å—ã:       {os.path.basename(OUTPUT_SKU_FILE)}")
    print(f"\nüß† –ë–∞–∑—ã –∑–Ω–∞–Ω–∏–π:")
    print(f"   –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π: {os.path.basename(KNOWLEDGE_BASE_FILE)}")
    print(f"   –ë–∞–∑–∞ –±—Ä–µ–Ω–¥–æ–≤: {os.path.basename(BRANDS_DB_FILE)}")
    print("="*80 + "\n")


def validate_settings():
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏ –≤—ã–≤–æ–¥ –æ—à–∏–±–æ–∫"""
    errors, warnings = check_files()
    
    # –í—ã–≤–æ–¥–∏–º —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    print_settings()
    
    # –í—ã–≤–æ–¥–∏–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
    if warnings:
        for warning in warnings:
            print(warning)
        print()
    
    # –í—ã–≤–æ–¥–∏–º –æ—à–∏–±–∫–∏
    if errors:
        print("\n" + "="*80)
        print("  –û–®–ò–ë–ö–ò –í –ù–ê–°–¢–†–û–ô–ö–ê–•")
        print("="*80)
        for error in errors:
            print(error)
        print("\nüí° –†–ï–®–ï–ù–ò–ï:")
        print("1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª settings.py")
        print("2. –ò–∑–º–µ–Ω–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ FOLDER_PATH –Ω–∞ –ø—É—Ç—å –∫ –≤–∞—à–µ–π –ø–∞–ø–∫–µ")
        print("3. –ò–ª–∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª—ã –≤ –ø–∞–ø–∫—É:")
        print(f"   {FOLDER_PATH}")
        print("="*80 + "\n")
        return False
    
    print("‚úì –í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã\n")
    return True


if __name__ == "__main__":
    # –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ —ç—Ç–æ–≥–æ —Ñ–∞–π–ª–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    print("\n" + "="*80)
    print("  –§–ê–ô–õ –ù–ê–°–¢–†–û–ï–ö –°–ò–°–¢–ï–ú–´ –ö–ê–¢–ï–ì–û–†–ò–ó–ê–¶–ò–ò")
    print("="*80)
    print("\nüìñ –ß—Ç–æ–±—ã –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:")
    print("   1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª: settings.py")
    print("   2. –ù–∞–π–¥–∏—Ç–µ —Ä–∞–∑–¥–µ–ª: –ü–£–¢–ò –ö –§–ê–ô–õ–ê–ú")
    print("   3. –ò–∑–º–µ–Ω–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ FOLDER_PATH")
    print("\nüìù –ü—Ä–∏–º–µ—Ä:")
    print('   FOLDER_PATH = "/home/user/documents/products"')
    print('   –∏–ª–∏')
    print('   FOLDER_PATH = "C:\\\\Users\\\\User\\\\Documents\\\\Products"')
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    validate_settings()
